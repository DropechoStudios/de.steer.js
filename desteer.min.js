var DE=DE||{};DE.Steer=DE.Steer||{};DE.Steer.Behaviors=function(){return function(){}}();DE.Steer.Behaviors.prototype.Align=function(a,b){for(var c=DE.Math.Vec2d(),d=b.length,e=0;e<d;++e)c.Add(b[e]);0<d&&(c.Scale(1/d),c.Sub(a));return c};DE.Steer.Behaviors.prototype.Arrive=function(a,b,c,d){d=d||5;var e=a.DistanceFrom(b);return 0<e?(c=DE.Math.Clamp(e/d,0,c),this.Seek(a,b,c)):DE.Math.Vec2d(0,0)};
DE.Steer.Behaviors.prototype.Cohese=function(a,b,c){for(var d=DE.Math.Vec2d(0,0),e=b.length,f=0;f<e;f++)d.Add(b[f]);return 0<e?(d.Scale(1/e),this.Arrive(a,d,c)):DE.Math.Vec2d(0,0)};DE.Steer.Behaviors.prototype.EvaDE=function(a,b,c,d,e){var f=DE.Math.Vector.Sub(b,a);d=DE.Math.HeadingVec(d);e=e||60;c=f.Length()/(c+e);b=DE.Math.Vector.Add(b,d.Normalize(c));return this.Flee(a,b)};
DE.Steer.Behaviors.prototype.Flee=function(a,b,c,d){d=d===unDEfined||-1===d||b.DistanceFrom(a)<=d;a=DE.Math.Vector.Sub(a,b).Normalize(c);return d?a:DE.Math.Vec2d(0,0)};DE.Steer.Behaviors.prototype.HiDE=function(){};DE.Steer.Behaviors.prototype.Interpose=function(a,b,c,d){b=DE.Math.Vector.MidPoint(b,c);return Arrive(a,b,d)};DE.Steer.Behaviors.prototype.ObstacleAvoid=function(){};
DE.Steer.Behaviors.prototype.Pursuit=function(a,b,c,d,e){var f=DE.Math.Vector.Sub(b,a);d=d instanceof DE.Math.Vector?d:DE.Math.HeadingVec(targetHeadingDEg);e=e||60;c=f.Length()/(c+e);b=DE.Math.Vector.Add(b,d.Normalize(c));return this.Seek(a,b)};DE.Steer.Behaviors.prototype.Seek=function(a,b,c){return DE.Math.Vector.Sub(b,a).Normalize(c)};
DE.Steer.Behaviors.prototype.Seperation=function(a,b){for(var c=DE.Math.Vec2d(0,0),d=b.length,e=0;e<d;e++){var f=DE.Math.Vector.Sub(a,b[e]),g=f.Length();c.Add(f.Normalize(128/g))}return c};DE.Steer.Behaviors.prototype.WanDEr=function(a,b,c){var d=DE.Math.Rand(-1,1),e=DE.Math.Rand(-1,1),d=DE.Math.Vec2d(d,e).Normalize();b.Add(d).Normalize(1);b=DE.Math.Vector.Add(b,DE.Math.Vec2d(10,0));c=DE.Math.Vector.LocalToWorld(b,c,a);return this.Seek(a,c,1)};DE=DE||{};DE.Steer=DE.Steer||{};DE.Steer.EntityBehaviors=function(){return function(a){this.entity=a;this.DE_wanDEr_target=DE.Math.Vec2d()}}();DE.Steer.EntityBehaviors.prototype.ToLocal=function(a){return DE.Math.Vector.WorldToLocal(a,this.entity.DE_heading())};DE.Steer.EntityBehaviors.prototype.Align=function(){};DE.Steer.EntityBehaviors.prototype.Arrive=function(a,b){var c=this.entity.DE_pos(),d=a.DE_pos(),e=this.entity.DE_max_speed();return DE.Steer.Behaviors.Arrive(c,d,e,b)};
DE.Steer.EntityBehaviors.prototype.Cohese=function(a){for(var b=this.entity.DE_pos(),c=this.entity.DE_max_speed(),d=[],e=0,f=a.length;e<f;e++)d.push(a.DE_pos());return DE.Steer.Behaviors.Cohese(b,d,c)};DE.Steer.EntityBehaviors.prototype.EvaDE=function(){var a=this.entity.DE_pos(),b=this.entity.DE_max_speed(),c=target.DE_pos(),d=target.DE_heading(),e=target.DE_max_speed();return DE.Steer.Behaviors.EvaDE(a,c,b,d,e)};
DE.Steer.EntityBehaviors.prototype.Flee=function(a,b){var c=this.entity.DE_pos();target.DE_pos();var d=this.entity.DE_max_speed();return DE.Steer.Behaviors.Flee(c,target,d,b)};DE.Steer.EntityBehaviors.prototype.HiDE=function(){};DE.Steer.EntityBehaviors.prototype.Interpose=function(){};DE.Steer.EntityBehaviors.prototype.ObstacleAvoid=function(){};
DE.Steer.EntityBehaviors.prototype.Pursuit=function(){var a=this.entity.DE_pos(),b=this.entity.DE_max_speed(),c=target.DE_pos(),d=target.DE_heading(),e=target.DE_max_speed();return DE.Steer.Behaviors.Pursuit(a,c,b,d,e)};DE.Steer.EntityBehaviors.prototype.Seek=function(a){var b=this.entity.DE_pos(),c=this.entity.DE_max_speed();a=a.DE_pos();return DE.Steer.Behaviors.Seek(b,a,c)};
DE.Steer.EntityBehaviors.prototype.Seperation=function(a){for(var b=this.entity.DE_pos(),c=[],d=0,e=a.length;d<e;d++)c.push(a.DE_pos());return DE.Steer.Behaviors.Seperation(b,c)};DE.Steer.EntityBehaviors.prototype.WanDEr=function(){var a=this.entity.DE_pos(),b=this.DE_wanDEr_target,c=this.entity.DE_heading();return DE.Steer.Behaviors.WanDEr(a,b,c)};DE=DE||{};DE.Steer=DE.Steer||{};DE.Steer.ExtenDErs=DE.Steer.ExtenDErs||{};
DE.Steer.ExtenDEr=function(){return new function(){this.Extend=function(a,b){if(a===unDEfined)throw new DE.Errors.ConversionError({property:"entity",message:"is unDEfined. Pass a non-null entity."});if(a instanceof DE.Math.Vector)return a;b=b||a.prototype&&a.prototype.constructor&&a.prototype.constructor.name;if(DE.Steer.ExtenDErs[b]===unDEfined)throw new DE.Errors.ConversionError({property:"DE.Steer.ExtenDErs."+b,message:"is unDEfined.  Register a converter for this type."});if(1>DE.Steer.ExtenDErs[b].length)throw new DE.Errors.ConversionError({property:"DE.Steer.ExtenDErs."+
b,message:"must accept at least one arg, which is the entity to be converted."});var c=DE.Steer.ExtenDErs[b](a);if(c.DE_pos===unDEfined)throw new DE.Errors.ConversionError({property:"entity.DE_pos",message:"is unDEfined. You must set the position getter in the converter."});if("function"!==typeof c.DE_pos)throw new DE.Errors.ConversionError({property:"entity.DE_pos",message:"is not a function. You must set the position getter in the converter."});if(c.DE_heading===unDEfined)throw new DE.Errors.ConversionError({property:"entity.DE_heading",
message:"is unDEfined. You must set the heading getter in the converter."});if("function"!==typeof c.DE_heading)throw new DE.Errors.ConversionError({property:"entity.DE_heading",message:"is not a function. You must set the heading getter in the converter."});if(c.DE_max_speed===unDEfined)throw new DE.Errors.ConversionError({property:"entity.DE_max_speed ",message:"is unDEfined. You must set the max_speed getter in the converter."});if("function"!==typeof c.DE_max_speed)throw new DE.Errors.ConversionError({property:"entity.DE_max_speed",
message:"is not a function. You must set the max_speed getter in the converter."});c.Steering=new DE.Steer.EntityBehaviors(a);return c}}}();DE=DE||{};DE.Steer=DE.Steer||{};DE.Steer.ExtenDErs=DE.Steer.ExtenDErs||{};DE.Steer.ExtenDErs.GameQuery=function(a,b){a.max_speed=b||10;a.DE_pos=function(){return DE.Math.Vec2d(a.xy())};a.DE_heading=function(){return DE.Math.HeadingVec(a.rotate())};a.DE_max_speed=function(){return a.max_speed};return a};DE=DE||{};DE.Math=DE.Math||{};DE.Math.PI=void 0!==Math?Math.PI:3.141592653;DE.Math.Clamp=function(a,b,c){a=Math.min(a,c);return Math.max(b,a)};DE.Math.Rand=function(a,b){return a!==unDEfined?DE.Math.Clamp(Math.random()*b,a,b):Math.random()};DE.Math.RandBool=function(){return 0.5<DE.Math.Rand(0,1)};DE.Math.RadToDEg=function(a){return DE.Math.CleanFloat(180*a/DE.Math.PI)};DE.Math.DEgToRad=function(a){return DE.Math.CleanFloat(a*DE.Math.PI/180)};DE.Math.CleanFloat=function(a){return parseFloat(a.toFixed(7))};DE=DE||{};DE.Math=DE.Math||{};DE.Math.Vector=function(){return function(a,b){"object"===typeof DE.Util.Unwrap(a)?(this.x=DE.Util.Unwrap(a.x)||0,this.y=DE.Util.Unwrap(a.y)||0):(this.x=DE.Util.Unwrap(a)||0,this.y=DE.Util.Unwrap(b)||0)}}();DE.Math.Vector.prototype.Scale=function(a){a=DE.Util.Unwrap(a)||1;this.x*=a;this.y*=a;return this};DE.Math.Vector.prototype.Add=function(a){a=DE.Util.Unwrap(a);this.x+=a.x;this.y+=a.y;return this};
DE.Math.Vector.prototype.Sub=function(a){a=DE.Util.Unwrap(a);this.x-=a.x;this.y-=a.y;return this};DE.Math.Vector.prototype.Dot=function(a){a=DE.Util.Unwrap(a);return this.x*a.x+this.y*a.y};DE.Math.Vector.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};DE.Math.Vector.prototype.LengthSQ=function(){return this.x*this.x+this.y*this.y};DE.Math.Vector.prototype.DistanceFrom=function(a){a=DE.Util.Unwrap(a);return(new DE.Math.Vector(this.x-a.x,this.y-a.y)).Length()};
DE.Math.Vector.prototype.Normalize=function(a){var b=this.Length(),b=0!=b?1/b:1;this.x*=b;this.y*=b;0<a&&this.Scale(a);return this};DE.Math.Vector.prototype.Perp=function(){return DE.Math.Vec2d(-this.y,this.x)};DE.Math.Vec2d=function(a,b){return new DE.Math.Vector(a,b)};DE.Math.HeadingVec=function(a){var b=DE.Math.DEgToRad(a);a=DE.Math.CleanFloat(Math.cos(b));b=DE.Math.CleanFloat(Math.sin(b));return DE.Math.Vec2d(a,b).Normalize()};
DE.Math.Vector.Add=function(a,b){a=DE.Util.Unwrap(a);b=DE.Util.Unwrap(b);return DE.Math.Vec2d(a.x+b.x,a.y+b.y)};DE.Math.Vector.Sub=function(a,b){a=DE.Util.Unwrap(a);b=DE.Util.Unwrap(b);return DE.Math.Vec2d(a.x-b.x,a.y-b.y)};DE.Math.Vector.Normalize=function(a,b){var c=DE.Math.Vec2d(a.x,a.y),d=c.Length(),d=0!=d?1/d:1;c.x*=d;c.y*=d;0<b&&c.Scale(b);return c};
DE.Math.Vector.HeadingToDEg=function(a){var b=DE.Math.Vec2d(1,0),c=DE.Math.Vector.Normalize(a),b=DE.Math.RadToDEg(Math.acos(b.Dot(c)));0>a.y&&(b=360-b);return b};DE.Math.Vector.WorldToLocal=function(a,b){var c=b.Perp(),c=[[b.x,c.x],[b.y,c.y]];return DE.Math.Vec2d(a.x*c[0][0]+a.y*c[0][1],a.x*c[1][0]+a.y*c[1][1])};
DE.Math.Vector.LocalToWorld=function(a,b,c){b=DE.Math.Vec2d(1,0);var d=DE.Math.DE.Math.Vector.HeadingToDEg(headingVec);b=DE.Math.DE.Math.Vector.WorldToLocal(DE.Math.HeadingVec(-d),b);d=b.Perp();d=[[b.x,d.x],[b.y,d.y]];b=DE.Math.CleanFloat(a.x*d[0][0]+a.y*d[0][1]);a=DE.Math.CleanFloat(a.x*d[1][0]+a.y*d[1][1]);return DE.Math.Vec2d(b,a).Add(c)};DE.Math.Vector.MidPoint=function(a,b){return DE.Vec2d(0.5*(a.x+b.x),0.5*(a.y+b.y))};
DE.Math.Vector.HeadingToDEgTest=function(){for(var a=0;360>a;a++){var b=DE.Math.CleanFloat(Math.cos(DE.Math.DEgToRad(a))),c=DE.Math.CleanFloat(Math.sin(DE.Math.DEgToRad(a))),b=DE.Math.Vec2d(b,c),c=DE.Math.DE.Math.Vector.HeadingToDEg(b);(c<a-1E-4||c>a+1E-4)&&console.log("heading:",b,"got:",c," Expected:",a)}};
DE.Math.Vector.VecTest=function(){for(var a=DE.Vec2d(1,0),b=0;360>=b;b+=5){var c=DE.Math.DE.Math.Vector.WorldToLocal(a,DE.Math.HeadingVec(b)),c=DE.Math.DE.Math.Vector.LocalToWorld(c,DE.Math.HeadingVec(b),DE.Math.Vec2d(0,0));(c.x<a.x-1E-4||c.x>a.x+1E-4)&&console.log("AT: ",b," Expected x to be:",a.x,"  Got:",c.x);(c.y<a.y-1E-4||c.y>a.y+1E-4)&&console.log("AT: ",b," Expected x to be:",a.y,"  Got:",c.y)}};DE=DE||{};DE.Errors={};DE.Errors.ConversionError=function(a){this.name=a.name||"ExtenDEr Error";this.message=a.message||"Unknown Error.";this.property=a.property+" "||"";this.toString=function(){return this.name+": "+this.property+this.message}};DE=DE||{};DE.Util=DE.Util||{};DE.Util.Unwrap=function(a){return"function"===typeof a?a():a};DE.Util.RemoveElement=function(a,b){for(var c=[],d=0;d<a.length;d++)c.push(a[d]);c.splice(b,1);return c};
