var DE=DE||{};DE.Errors={};DE.Errors.ConversionError=function(a){this.name=a.name||"Extender Error";this.message=a.message||"Unknown Error.";this.property=a.property+" "||"";this.toString=function(){return this.name+": "+this.property+this.message}};DE=DE||{};DE.Util=DE.Util||{};DE.Util.Unwrap=function(a){return"function"===typeof a?a():a};DE.Util.RemoveElement=function(a,b){for(var c=[],d=0;d<a.length;d++)c.push(a[d]);c.splice(b,1);return c};DE=DE||{};DE.Steer=DE.Steer||{};DE.Steer.Extenders=DE.Steer.Extenders||{};DE.Steer.Extenders.GameQuery=function(a,b){a.max_speed=b||10;a.de_pos=function(){return DE.Math.Vec2d(a.xy())};a.de_heading=function(){return DE.Math.HeadingVec(a.rotate())};a.de_max_speed=function(){return a.max_speed};return a};DE=DE||{};DE.Steer=DE.Steer||{};DE.Steer.Extenders=DE.Steer.Extenders||{};
DE.Steer.Extender=function(){return new function(){this.Extend=function(a,b){if(void 0===a)throw new DE.Errors.ConversionError({property:"entity",message:"is undefined. Pass a non-null entity."});if(a instanceof DE.Math.Vector)return a;b=b||a.prototype&&a.prototype.constructor&&a.prototype.constructor.name;if(void 0===DE.Steer.Extenders[b])throw new DE.Errors.ConversionError({property:"DE.Steer.Extenders."+b,message:"is undefined.  Register a converter for this type."});if(1>DE.Steer.Extenders[b].length)throw new DE.Errors.ConversionError({property:"DE.Steer.Extenders."+
b,message:"must accept at least one arg, which is the entity to be converted."});var c=DE.Steer.Extenders[b](a);if(void 0===c.de_pos)throw new DE.Errors.ConversionError({property:"entity.de_pos",message:"is undefined. You must set the position getter in the converter."});if("function"!==typeof c.de_pos)throw new DE.Errors.ConversionError({property:"entity.de_pos",message:"is not a function. You must set the position getter in the converter."});if(void 0===c.de_heading)throw new DE.Errors.ConversionError({property:"entity.de_heading",
message:"is undefined. You must set the heading getter in the converter."});if("function"!==typeof c.de_heading)throw new DE.Errors.ConversionError({property:"entity.de_heading",message:"is not a function. You must set the heading getter in the converter."});if(void 0===c.de_max_speed)throw new DE.Errors.ConversionError({property:"entity.de_max_speed ",message:"is undefined. You must set the max_speed getter in the converter."});if("function"!==typeof c.de_max_speed)throw new DE.Errors.ConversionError({property:"entity.de_max_speed",
message:"is not a function. You must set the max_speed getter in the converter."});c.Steering=new DE.Steer.EntityBehaviors(a);return c}}}();var de=de||{};de.math=de.math||{};de.math.PI=void 0!==Math?Math.PI:3.141592653;de.math.Clamp=function(a,b,c){a=Math.min(a,c);return Math.max(b,a)};de.math.Rand=function(a,b){return void 0!==a?de.math.Clamp(Math.random()*b,a,b):Math.random()};de.math.RandBool=function(){return 0.5<de.math.Rand(0,1)};de.math.RadToDeg=function(a){return de.math.CleanFloat(180*a/de.math.PI)};de.math.DegToRad=function(a){return de.math.CleanFloat(a*de.math.PI/180)};de.math.CleanFloat=function(a){return parseFloat(a.toFixed(7))};de=de||{};de.math=de.math||{};de.math.Vector=function(){return de.math.Vector}();de.math.Vector.prototype.Scale=function(a){a=DE.Util.Unwrap(a)||1;this.x*=a;this.y*=a;return this};de.math.Vector.prototype.Add=function(a){a=DE.Util.Unwrap(a);this.x+=a.x;this.y+=a.y;return this};de.math.Vector.prototype.Sub=function(a){a=DE.Util.Unwrap(a);this.x-=a.x;this.y-=a.y;return this};de.math.Vector.prototype.Dot=function(a){a=DE.Util.Unwrap(a);return this.x*a.x+this.y*a.y};
de.math.Vector.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};de.math.Vector.prototype.LengthSQ=function(){return this.x*this.x+this.y*this.y};de.math.Vector.prototype.DistanceFrom=function(a){a=DE.Util.Unwrap(a);return(new de.math.Vector(this.x-a.x,this.y-a.y)).Length()};de.math.Vector.prototype.Normalize=function(a){var b=this.Length(),b=0!=b?1/b:1;this.x*=b;this.y*=b;0<a&&this.Scale(a);return this};
de.math.Vector.prototype.Perp=function(){return de.math.Vec2d(-this.y,this.x)};de.math.Vec2d=function(a,b){return new de.math.de.math.Vector(a,b)};de.math.HeadingVec=function(a){var b=de.math.DegToRad(a);a=de.math.CleanFloat(Math.cos(b));b=de.math.CleanFloat(Math.sin(b));return de.math.Vec2d(a,b)};de.math.Vector.Add=function(a,b){a=DE.Util.Unwrap(a);b=DE.Util.Unwrap(b);return de.math.Vec2d(a.x+b.x,a.y+b.y)};
de.math.Vector.Sub=function(a,b){a=DE.Util.Unwrap(a);b=DE.Util.Unwrap(b);return de.math.Vec2d(a.x-b.x,a.y-b.y)};de.math.Vector.Normalize=function(a,b){var c=de.math.Vec2d(a.x,a.y),d=c.Length(),d=0!=d?1/d:1;c.x*=d;c.y*=d;0<b&&c.Scale(b);return c};de.math.Vector.HeadingToDeg=function(a){var b=de.math.Vec2d(1,0);a=de.math.de.math.Vector.Normalize(a);b=de.math.RadToDeg(Math.acos(b.Dot(a)));0>a.y&&(b=360-b);return b};
de.math.Vector.WorldToLocal=function(a,b){var c=b.Perp(),c=[[b.x,c.x],[b.y,c.y]];return de.math.Vec2d(a.x*c[0][0]+a.y*c[0][1],a.x*c[1][0]+a.y*c[1][1])};de.math.Vector.LocalToWorld=function(a,b,c){var d=de.math.Vec2d(1,0);b=de.math.de.math.Vector.HeadingToDeg(b);d=de.math.de.math.Vector.WorldToLocal(de.math.HeadingVec(-b),d);b=d.Perp();b=[[d.x,b.x],[d.y,b.y]];d=de.math.CleanFloat(a.x*b[0][0]+a.y*b[0][1]);a=de.math.CleanFloat(a.x*b[1][0]+a.y*b[1][1]);return de.math.Vec2d(d,a).Add(c)};
de.math.Vector.MidPoint=function(a,b){return DE.Vec2d(0.5*(a.x+b.x),0.5*(a.y+b.y))};de.math.Vector.HeadingToDegTest=function(){for(var a=0;360>a;a++){var b=de.math.CleanFloat(Math.cos(de.math.DegToRad(a))),c=de.math.CleanFloat(Math.sin(de.math.DegToRad(a))),b=de.math.Vec2d(b,c),c=de.math.de.math.Vector.HeadingToDeg(b);(c<a-1E-4||c>a+1E-4)&&console.log("heading:",b,"got:",c," Expected:",a)}};
de.math.Vector.VecTest=function(){for(var a=DE.Vec2d(1,0),b=0;360>=b;b+=5){var c=de.math.de.math.Vector.WorldToLocal(a,de.math.HeadingVec(b)),c=de.math.de.math.Vector.LocalToWorld(c,de.math.HeadingVec(b),de.math.Vec2d(0,0));(c.x<a.x-1E-4||c.x>a.x+1E-4)&&console.log("AT: ",b," Expected x to be:",a.x,"  Got:",c.x);(c.y<a.y-1E-4||c.y>a.y+1E-4)&&console.log("AT: ",b," Expected x to be:",a.y,"  Got:",c.y)}};de=de||{};de.steer=de.steer||{};de.steer.Behaviors=function(){return function(){}}();de.steer.Behaviors.prototype.Align=function(a,b){for(var c=DE.Math.Vec2d(),d=b.length,e=0;e<d;++e)c.Add(b[e]);0<d&&(c.Scale(1/d),c.Sub(a));return c};de.steer.Behaviors.prototype.Arrive=function(a,b,c,d){d=d||5;var e=a.DistanceFrom(b);return 0<e?(c=DE.Math.Clamp(e/d,0,c),this.Seek(a,b,c)):DE.Math.Vec2d(0,0)};
de.steer.Behaviors.prototype.Cohese=function(a,b,c){for(var d=DE.Math.Vec2d(0,0),e=b.length,f=0;f<e;f++)d.Add(b[f]);return 0<e?(d.Scale(1/e),this.Arrive(a,d,c)):DE.Math.Vec2d(0,0)};de.steer.Behaviors.prototype.Evade=function(a,b,c,d,e){var f=DE.Math.Vector.Sub(b,a);d=DE.Math.HeadingVec(d);e=e||60;c=f.Length()/(c+e);b=DE.Math.Vector.Add(b,d.Normalize(c));return this.Flee(a,b)};
de.steer.Behaviors.prototype.Flee=function(a,b,c,d){d=void 0===d||-1===d||b.DistanceFrom(a)<=d;a=DE.Math.Vector.Sub(a,b).Normalize(c);return d?a:DE.Math.Vec2d(0,0)};de.steer.Behaviors.prototype.Hide=function(){};de.steer.Behaviors.prototype.Interpose=function(a,b,c,d){b=DE.Math.Vector.MidPoint(b,c);return Arrive(a,b,d)};de.steer.Behaviors.prototype.ObstacleAvoid=function(){};
de.steer.Behaviors.prototype.Pursuit=function(a,b,c,d,e){var f=DE.Math.Vector.Sub(b,a);d=d instanceof DE.Math.Vector?d:DE.Math.HeadingVec(targetHeadingDeg);e=e||60;c=f.Length()/(c+e);b=DE.Math.Vector.Add(b,d.Normalize(c));return this.Seek(a,b)};de.steer.Behaviors.prototype.Seek=function(a,b,c){return DE.Math.Vector.Sub(b,a).Normalize(c)};
de.steer.Behaviors.prototype.Seperation=function(a,b){for(var c=DE.Math.Vec2d(0,0),d=b.length,e=0;e<d;e++){var f=DE.Math.Vector.Sub(a,b[e]),g=f.Length();c.Add(f.Normalize(128/g))}return c};de.steer.Behaviors.prototype.Wander=function(a,b,c){var d=DE.Math.Rand(-1,1),e=DE.Math.Rand(-1,1),d=DE.Math.Vec2d(d,e).Normalize();b.Add(d).Normalize(1);b=DE.Math.Vector.Add(b,DE.Math.Vec2d(10,0));c=DE.Math.Vector.LocalToWorld(b,c,a);return this.Seek(a,c,1)};de=de||{};de.steer=de.steer||{};de.steer.EntityBehaviors=function(){return function(a){this.entity=a;this.de_wander_target=de.Math.Vec2d()}}();de.steer.EntityBehaviors.prototype.ToLocal=function(a){return de.Math.Vector.WorldToLocal(a,this.entity.de_heading())};de.steer.EntityBehaviors.prototype.Align=function(){};de.steer.EntityBehaviors.prototype.Arrive=function(a,b){var c=this.entity.de_pos(),d=a.de_pos(),e=this.entity.de_max_speed();return de.steer.Behaviors.Arrive(c,d,e,b)};
de.steer.EntityBehaviors.prototype.Cohese=function(a){for(var b=this.entity.de_pos(),c=this.entity.de_max_speed(),d=[],e=0,f=a.length;e<f;e++)d.push(a.de_pos());return de.steer.Behaviors.Cohese(b,d,c)};de.steer.EntityBehaviors.prototype.Evade=function(){var a=this.entity.de_pos(),b=this.entity.de_max_speed(),c=target.de_pos(),d=target.de_heading(),e=target.de_max_speed();return de.steer.Behaviors.Evade(a,c,b,d,e)};
de.steer.EntityBehaviors.prototype.Flee=function(a,b){var c=this.entity.de_pos();target.de_pos();var d=this.entity.de_max_speed();return de.steer.Behaviors.Flee(c,target,d,b)};de.steer.EntityBehaviors.prototype.Hide=function(){};de.steer.EntityBehaviors.prototype.Interpose=function(){};de.steer.EntityBehaviors.prototype.ObstacleAvoid=function(){};
de.steer.EntityBehaviors.prototype.Pursuit=function(){var a=this.entity.de_pos(),b=this.entity.de_max_speed(),c=target.de_pos(),d=target.de_heading(),e=target.de_max_speed();return de.steer.Behaviors.Pursuit(a,c,b,d,e)};de.steer.EntityBehaviors.prototype.Seek=function(a){var b=this.entity.de_pos(),c=this.entity.de_max_speed();a=a.de_pos();return de.steer.Behaviors.Seek(b,a,c)};
de.steer.EntityBehaviors.prototype.Seperation=function(a){for(var b=this.entity.de_pos(),c=[],d=0,e=a.length;d<e;d++)c.push(a.de_pos());return de.steer.Behaviors.Seperation(b,c)};de.steer.EntityBehaviors.prototype.Wander=function(){var a=this.entity.de_pos(),b=this.de_wander_target,c=this.entity.de_heading();return de.steer.Behaviors.Wander(a,b,c)};
